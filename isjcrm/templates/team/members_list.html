<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Modern admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities with bitcoin dashboard.">
    <meta name="keywords" content="admin template, modern admin template, dashboard template, flat admin template, responsive admin template, web app, crypto dashboard, bitcoin dashboard">
    <meta name="author" content="PIXINVENT">
    <title>Members of team</title>
    <link rel="apple-touch-icon" href="../static/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="../static/app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i%7CQuicksand:300,400,500,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../static/app-assets/fonts/material-icons/material-icons.css">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="../static/app-assets/vendors/css/material-vendors.min.css">
    <link rel="stylesheet" type="text/css" href="../static/app-assets/vendors/css/tables/datatable/dataTables.bootstrap4.min.css">
    <!-- END: Vendor CSS-->


    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='../static/app-assets/css/material.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='../static/app-assets/css/components.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='../static/app-assets/css/bootstrap-extended.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='../static/app-assets/css/material-extended.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='../static/app-assets/css/material-colors.css') }}">
    <!-- END: Theme CSS-->

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet" type="text/css" href="../static/app-assets/css/core/menu/menu-types/material-vertical-compact-menu.css">
    <link rel="stylesheet" type="text/css" href="../static/app-assets/css/core/colors/material-palette-gradient.css">
    <link rel="stylesheet" type="text/css" href="../static/app-assets/fonts/mobiriseicons/24px/mobirise/style.css">
    <link rel="stylesheet" type="text/css" href="../static/app-assets/css/pages/app-contacts.css">
    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="../static/assets/css/style.css">
    <!-- END: Custom CSS-->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/7.8.1/rxjs.umd.min.js"></script>

</head>
<!-- END: Head-->

<!-- BEGIN: Body-->

<body class="vertical-layout vertical-compact-menu material-vertical-layout material-layout content-detached-left-sidebar app-contacts  fixed-navbar"  data-open="click" data-menu="vertical-compact-menu" data-col="2-columns">

    {% include "layout.html" %}
    {% block content %}
    <!-- END: Main Menu-->
    <!-- BEGIN: Content-->
    <div class="app-content content">
        <div class="content-header row">
        </div>
        <div class="content-overlay"></div>
        <div class="content-wrapper">
            <div class="content-detached">
                <div class="content-body ">
                    <div class="content-overlay"></div>
                    <div class="row">
                        <div class="col-12 mt-1 mb-1">
                            <h1 class="text-uppercase">Members of team marketing</h1>
                        </div>
                    </div>
                    <section class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body" style="display: grid; grid-template-columns: 4fr 1fr ;">
                                    <div class="bug-list-search">
                                        <div class="bug-list-search-content">
                                            <div class="sidebar-toggle d-block d-lg-none"><i class="ft-menu font-large-1"></i></div>
                                            <form action="#">
                                                <div class="position-relative">
                                                    <input type="search" id="search-users" class="form-control" placeholder="Search members...">
                                                    <div class="form-control-position">
                                                        <i class="la la-search text-size-base text-muted la-rotate-270"></i>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm " data-toggle="modal" data-target="#AddContactModal"><i class="d-md-none d-block ft-plus white"></i>
                                        <span class="d-md-block d-none">Add member</span></button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="row all-contacts">

                        <div class="col-12">
                            <div class="card">
                                <div class="card-head">
                                    <div class="card-header">
                                        <div class="heading-elements mt-0">
                                            <div class="modal fade" id="AddContactModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <section class="contact-form">
                                                            <form id="form-add-contact" class="contact-input">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="exampleModalLabel1">Add New Contact</h5>
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="contact-name" class="contact-name form-control" placeholder="Name">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="contact-email" class="contact-email form-control" placeholder="Email">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="contact-phone" class="contact-phone form-control" placeholder="Phone Number">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <div class="custom-control custom-checkbox">
                                                                            <input type="checkbox" class="custom-control-input" id="checkboxsmallallq">
                                                                            <label class="custom-control-label" for="checkboxsmallallq">favorite</label>
                                                                        </div>
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="file" class="form-control-file" id="user-image">
                                                                    </fieldset>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <fieldset class="form-group position-relative has-icon-left mb-0">
                                                                        <button type="button" id="add-contact-item" class="btn btn-info add-contact-item" data-dismiss="modal"><i class="la la-paper-plane-o d-block d-lg-none"></i> <span class="d-none d-lg-block">Add New</span></button>
                                                                    </fieldset>
                                                                </div>
                                                            </form>
                                                        </section>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal fade" id="EditUserModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <section class="contact-form">
                                                            <form id="form-edit-contact" class="contact-input">
                                                                <div class="modal-header">
                                                                    <h5 class="modal-title" id="exampleModalLabel">Edit user</h5>
                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                        <span aria-hidden="true">&times;</span>
                                                                    </button>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="username" class="name form-control" placeholder="Username">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="first_name" class="name form-control" placeholder="First name">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="last_name" class="name form-control" placeholder="Last name">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="email" class="name form-control" placeholder="Email">
                                                                    </fieldset>
                                                                    <fieldset class="form-group col-12">
                                                                        <input type="text" id="phone_number" class="email form-control" placeholder="Phone number">
                                                                    </fieldset>
                                                                    <span id="fav" class="d-none"></span>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <fieldset class="form-group position-relative has-icon-left mb-0">
                                                                        <button type="button" id="edit-user-item" class="btn btn-info edit-contact-item" data-dismiss="modal"><i class="la la-paper-plane-o d-lg-none"></i> <span class="d-none d-lg-block">Edit</span></button>
                                                                    </fieldset>
                                                                </div>
                                                            </form>
                                                        </section>
                                                    </div>
                                                </div>
                                            </div>



                                        </div>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div class="card-body">
                                        <!-- Task List table -->
                                        <div class="table-responsive">
                                            <table id="members" class="table table-white-space table-bordered row-grouping display no-wrap icheck table-middle ">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Email</th>
                                                        <th>Phone</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                {% for member in members %}
                                                <tbody id="table-body">
                                                    <tr class="member-row">
                                                        <td>
                                                            <div class="media transparentHover" >
                                                                <div class="media-left pr-1"><span class="avatar avatar-sm avatar-online rounded-circle"><img src="../static/app-assets/images/portrait/small/avatar-s-13.png" alt="avatar"><i></i></span></div>
                                                                <div class="media-body media-middle transparentHover">
                                                                    <a class="media-heading name transparentHover" href="{{ url_for('ui_users.member_details', username=member.username) }}">{{ member.first_name }} {{ member.last_name }}</a>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center">
                                                            <a class="email" href="mailto:email@example.com">{{member.email}}</a>
                                                        </td>
                                                        <td class="phone">{{member.phone_number}}</td>
                                                        <td> 
                                                            <a class="primary edit mr-1" data-id="{{member.username}}" ><i class="la la-pencil"></i></a>
                                                            <a class="danger delete mr-1"><i class="la la-trash-o"></i></a>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                                {% endfor %}
                                                <tfoot>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Email</th>
                                                        <th>Phone</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Content-->

    <div class="sidenav-overlay"></div>
    <div class="drag-target"></div>

    <!-- BEGIN: Footer-->
    {% include "footer.html" %}
    <!-- END: Footer-->

    <script>
        username = ""
        // Importer les observables nécessaires de RxJS
        const { fromEvent } = rxjs;
        const { map } = rxjs.operators;
        const updateSubject = new rxjs.Subject();

        $(document).ready(function() {
            // Lorsque le bouton "Edit" est cliqué
            $('.primary').click(function() {
                // Récupérer l'ID du candidat à partir de l'attribut data
                var userId = $(this).data('id');
                username = userId

                // alert(userId);
           
                // Récupérer les informations du candidat par Ajax (remplacez cette partie avec votre logique)
                $.ajax({
                    url: 'users/get_user_by_id/' + userId,
                    method: 'GET',
                    success: function(data) {
                        // Remplir les champs du formulaire dans le modal avec les données du candidat
                        $('#username').val(data.username);
                        $('#first_name').val(data.first_name);
                        $('#last_name').val(data.last_name);
                        $('#email').val(data.email);
                        $('#phone_number').val(data.phone_number);
                        $('#fav').text(data.favorite).addClass('d-none');

                        // Ouvrir le modal
                        $('#EditUserModal').modal('show');
                    },
                    error: function(err) {
                        console.log(err);
                    }
                });
            });

            // Lorsque le bouton "Edit" dans le modal est cliqué
            $('#edit-user-item').click(function() {
                // Récupérer les données du formulaire
                var formData = {
                    'username': $('#username').val(),
                    'first_name': $('#first_name').val(),
                    'last_name': $('#last_name').val(),
                    'email': $('#email').val(),
                    'phone_number': $('#phone_number').val(),
                };


                // Envoyer les données du formulaire par Ajax
                $.ajax({
                    url: 'users/update_user/' + username,
                    method: 'PUT',
                    data: formData,
                    success: function(response) {
                        // Fermer le modal
                        $('#EditUserModal').modal('hide');

                        showAlert('success', response.message);

                        // Mettre à jour les données affichées dans le tableau sans actualiser la page
                        // Vous devrez implémenter cette fonctionnalité en fonction de votre structure HTML
                        updateTableWithData(formData);
                    },
                    error: function(err) {
                        console.log(err.responseJSON.message);
                    }
                });
            });

            // Souscrire à des mises à jour
            updateSubject.subscribe(userData => {
                var tableRow = $('#members tbody tr[data-user-id="' + userData.username + '"]');

                tableRow.find('.name').text(userData.first_name + ' ' + userData.last_name);
                tableRow.find('.email').attr('href', 'mailto:' + userData.email).text(userData.email);
                tableRow.find('.phone').text(userData.phone_number);

                console.log('Membre mis à jour avec succès! ', "de ", userData.username);
            });

            function updateTableWithData(userData) {
                updateSubject.next(userData);   
            }

            function showAlert(type, message) {
                // Afficher une alerte Bootstrap en fonction du type
                var alertClass = (type === 'success') ? 'alert-success' : 'alert-danger';

                var alertHtml = '<div class="alert ' + alertClass + ' alert-dismissible fade show" role="alert">' +
                                '<strong>' + type.charAt(0).toUpperCase() + type.slice(1) + '!</strong> ' + message +
                                '<button type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                                '<span aria-hidden="true">&times;</span></button></div>';

                // Ajouter l'alerte à un conteneur d'alertes dans votre page HTML
                $('#alert-container').html(alertHtml);
            }


        });

    </script>
    
    
    <!-- BEGIN: Vendor JS-->
    <script src="../static/app-assets/vendors/js/material-vendors.min.js"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="../static/app-assets/js/core/app-menu.js"></script>
    <script src="../static/app-assets/js/core/app.js"></script>
    <script src="../static/app-assets/js/core/app.js"></script>
    <!-- END: Theme JS-->

    <!-- BEGIN: Page JS-->

    <!-- END: Page JS-->



    {% endblock %}
</body>
<!-- END: Body-->

</html>